<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-cache"/>
<meta http-equiv="Expires" content="-1"/>
<title>新闻客户端可视化专题制作</title>
<link type="text/css" rel="stylesheet" href="http://temp.163.com/special/00804IN1/sw-pub.css" />
<link type="text/css" rel="stylesheet" href="http://temp.163.com/special/00804J6L/sw-step2-v2.4.css"/> 
<link href="/springgo/css/redmond/jquery-ui-1.8.7.custom.css" rel="stylesheet" type="text/css" />
<link href="/springgo/css/appcms.css" rel="stylesheet" type="text/css" />
<link href="/springgo/css/win7.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/springgo/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="/springgo/js/jquery-ui-1.8.7.custom.min.js"></script>
<script type="text/javascript" src="/springgo/js/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/springgo/js/jquery.slidedown.js"></script>
<!-- 拖拽排序-->
<script src="/springgo/js/jquery.ui.core.js"></script>
<script src="/springgo/js/jquery.ui.mouse.js"></script>
<script src="/springgo/js/jquery.ui.sortable.js"></script>			
</head>
<body>
	<div id="autotopic" class="dialog" title="添加子模块">
	  <input type="hidden" id="id" name="id" value=""/>
	  <input type="hidden" id="type" name="type" value=""/>
	  <input type="hidden" id="isedit" name="isedit" value="false"/>
	  <input type="hidden" id="index" name="index" value="0"/>		
		<form id="params-velList">			
			<div class="slideContent cms">
			<table class="formLayout fourCol">
				<tbody>
					<tr>
						<th></th>
						<td></td>
						<th></th>
						<td></td>
					</tr>
					<tr>
						<th><label for="tid">栏目 ID：</label></th>
						<td>
							<input id="tid" type="text" name="tid" style="width: 100px;" /><br />
							<span class="tips"><span class="required">*</span>必填。</span>
						</td>
						<th><label for="number">读取条数：</label></th>
						<td><input id="number" type="text" name="number" value="10" style="width: 50px;" maxlength="3" />
						<span class="tips">默认为10。</span></td>
					</tr>
					<tr class="alter-blue">
						<th><label for="tname">板块名称：</label></th>
						<td><input id="tname" type="text" name="tname" style="width: 100px;" maxlength="20" /><br />
							<span class="tips"><span class="required">*</span>必填。</span>
						</td>
						<th><label for="orderby">排序方式：</label></th>
						<td>
							<select id="orderby" name="orderby">
								<option value="2">时间倒序</option>
								<option value="1">权重倒序</option>
								</select>
						</td>
					</tr>
					<tr>
						<th><label for="pointstart">最小权重：</label></th>
						<td><input id="pointstart" type="text" name="pointstart" value="60" style="width: 50px;" maxlength="3" /> <span class="tips">默认为60。</span></td>
						<th><label for="pointend">最大权重：</label></th>
						<td><input id="pointend" type="text" name="pointend" value="255" style="width: 50px;" maxlength="3" />
						<span class="tips">默认为255。</span></td>
					</tr>
				</tbody>
			</table>
			</div>
		</form>		
</div>



<div id="webViewTopic" class="dialog" title="添加子模块" >

<table id="webViewTopicDiv" style="display: none">
<tbody>
    <tr>
		<th><label for="tid">title</label></th>
		<td>
			<input id="tid" type="text" name="webViewTitle" style="width: 100px;" /><br />
			<span class="tips"><span class="required">*</span>必填。</span>
		</td>
		<th><label for="number">图片地址：</label></th>
		<td>
			<input id="tid" type="text" name="webViewPic" style="width: 100px;" /><br />
			<span class="tips"><span class="required">*</span>必填。</span>
		</td>
	</tr>
	<tr>
		<th><label for="tname">链接地址：</label></th>
		<td><input id="tname" type="text" name="webViewUrl" style="width: 100px;" maxlength="20"  value="1"/><br />
			<span class="tips"><span class="required">*</span>必填。</span>
		</td>
		<th><label for="tname">顺序：</label></th>
		<td>
		    <select name="priority">
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
				<option value="6">6</option>
				<option value="7">7</option>
			</select>
		</td>
	</tr>
	<tr>
		<th><label for="tname"><input type="button" value="删除图片" onclick="$(this).parent().parent().parent().prev().remove();$(this).parent().parent().parent().prev().remove();$(this).parent().parent().parent().remove();"/></label></th>
	</tr>
	</tbody>
</table>
<input type="button" id="webviewbutton" value="添加图片" onclick="$('#webViewTable tbody').append($('#webViewTopicDiv tbody').html())"/>
      <div id="webViewhidden" style="display: none">
	      <input type="hidden" id="id" name="id" value="123"/>
		  <input type="hidden" id="type" name="type" value=""/>
		  <input type="hidden" id="isedit" name="isedit" value="false"/>
		  <input type="hidden" id="index" name="index" value="0"/>		
	  </div>
	  <form id="params-velList">			
			<div class="slideContent cms">
			<table id="webViewTable" class="formLayout fourCol">
				<tbody>
					<tr>
						<th></th>
						<td></td>
						<th></th>
						<td></td>
					</tr>
				</tbody>
			</table>
			</div>
		</form>		
</div>	





	

<div class="wrapper">
		<div class="">
			<div class="step" style="overflow: visible;">
				<div class="step-name">您正在制作专题：<a href="http://c.3g.163.com/nc/special/S1372643678666.html"><span>S1372643678666</span></a> 
				<a id="toStep1" href="sw-step1.jsp?edit=true&amp;sid=S1372643678666" class="back">
				<img src="/springgo/image/setting.png" alt="设置专题页面属性" /></a></div>
				<ul id="viewNav" class="step-nav">
					<li>
						<input type="button" value="发布专题" id="release" />
					</li>		
				</ul>
			</div>
    </div>
    <div class="clear"></div>      
      <div class="container"> 		
          <div class="boxgridSet">
                  <!--****************带图新闻列表****************-->
                  <div class="box imgnews">
                      <div class="addImgNews" style="display:none">
                          <img id="addImgNewsTopic" src="/springgo/image/add_white.png"/>
                      </div>
                      <div class="boxgrid " style="background:#d6e7ff">                
                           <h3>带图新闻列表</h3>
                           <div class="content">
                           	<img width="200" height="200" src="/springgo/image/imgnews.png"/>
                           </div>
                      </div>            
                  </div>                  
                  <!--****************图集****************-->
                  <div class="box photoset">
                      <div class="addPhoto" style="display:none">
                          <img id="addPhotoTopic" src="/springgo/image/add_white.png"/>
                      </div>
                      <div class="boxgrid" style="background:#d6e7ff">                
                           <h3>图集</h3>
                           <div class="content">
                           	<img width="200" height="200" src="/springgo/image/photoset.png"/>
                           </div>
                      </div>            
                  </div>
                  <!--****************视频****************-->
                  <div class="box1 video">
                      <div class="addVideo" style="display:none" style="background:#B0EB17">
                          <img id="addVideoTopic" src="/springgo/image/add_white.png"/>
                      </div>
                      <div class="boxgrid1" style="background:#d6e7ff">             
                           <h3>视频</h3>
                           <div class="">
                           	<img class="img_video" width="200" height="200" src="/springgo/image/video.png"/>
                           </div>
                      </div>            
                  </div>                   
                  <!--****************不带图新闻列表****************-->
                  <div class="box news">
                      <div class="addNews" style="display:none">
                          <img id="addNewsTopic" src="/springgo/image/add_white.png"/>
                      </div>
                      <div class="boxgrid " style="background:#d6e7ff">                
                           <h3>不带图新闻列表</h3>
                           <div class="content">
                           	<img width="200" height="200" src="/springgo/image/news.png"/>
                           </div>
                      </div>            
                  </div>
                  <!--****************相关专题****************-->
                  <div class="box slidedown special">
                      <div class="addSpecial" style="display:none">
                          <img id="addSpecialTopic" src="/springgo/image/add_white.png"/>
                      </div>
                      <div class="boxgrid " style="background:#d6e7ff">                
                           <h3>相关专题</h3>
                           <div class="content">
                           	<img width="200" height="200" src="/springgo/image/special.png"/>
                           </div>
                      </div>            
                  </div>
                  
                  <div class="box slidedown webview">
                      <div>
                          <img id="addWebview" src="/springgo/image/add_white.png"/>
                      </div>
                      <div class="boxgrid " style="background:#d6e7ff">                
                           <h3>webview</h3>
                           <div class="content">
                           	<img width="200" height="200" src="/springgo/image/special.png"/>
                           </div>
                      </div>            
                  </div>
                                                        
          </div>          
          <!--<div class="clear"></div>-->
		</div>
			<div class="preview">
			<div class="preheader"></div>
			<div class="prebody"></div>
			<div class="prefooter"></div>
		</div>  	                
    <div class="footer"></div>        
   </div>

<script>	
	var sid = "S1372643678666";
	
	$(document).ready(function(){			
		preview();	
	});
	
	//刷新
	var preview = function(){
		$.ajax({
		   type: "POST",
		   url: "/nc/special/preview/",
		   data: "sid=" + sid,
		   success: function(data){
			   $(".prebody").empty();
			   $(".prebody").html(data);
			   $(".sortTopics").sortable(); //拖拽排序
		  }
		}); 
		
		$.ajax({
			   type: "POST",
			   url: "/springgo/spring/nc/special/topic/previewWevView.do",
			   data: "sid=" + sid,
			   success: function(data){
				   var jsonArray = eval(data);
				   var a = jsonArray.length;
				   for(var b=0;b<a;b++){
					   $("#webviewbutton").click();
					   $("#webViewTable input[name='webViewUrl']:eq("+b+")").val(jsonArray[b].webViewUrl);
					   $("#webViewTable input[name='webViewTitle']:eq("+b+")").val(jsonArray[b].webViewTitle);
					   $("#webViewTable input[name='webViewPic']:eq("+b+")").val(jsonArray[b].webViewPic);
					   $("#webViewTable select[name='priority']:eq("+b+")").children(":eq("+jsonArray[b].priority+")").attr("selected","selected");
				   }
				   
			  }
		});
	}
	
	$(function() {
		
	//发布按钮	
	$("#release").click(function(){
		var _url  = "/nc/special/release/";
		var _data = {};
		_data['sid'] = sid;
		var indexs = [];
		$('.sortItem').each(function(){
			indexs.push($(this).attr('id'));
		});
		_data['indexs'] = indexs.join(); 
		$.post(_url,_data,function(data){
			if(data && data['result']==true){
				alert("专题发布成功");
				document.location.href = '/nc/special/list/';
			}else{
				alert("发布失败，请检查后重试!");	
			}
		});	
	});
	
	//修改栏目.
	$(".mofifyTopic").live("click",function(){
		var id = $(this).attr('id');		
		var _url = "/nc/special/topic/show/";
		var _data = {};
		_data['id'] = id;
		_data['sid'] = sid;
		$.getJSON(_url,_data,function(data){
			$("#autotopic #id").val(id);
			$( "#autotopic #isedit" ).val("true");	
			if (data != ''){		
				var tid = data.tid;
				var tname = data.tname;
				var number = data.num;
				var lspri = data.lspri;
				var point = new Array(); //定义一数组
				point = lspri.split("-"); //字符分割   
				var pointstart = "";
				var pointend = "";
				if (point.length==2){
					pointstart = point[0];
					pointend = point[1];
				}
				var orderby = data.orderby;
				var index = data.index;
				var type = data.type;
				$("#autotopic input[name='tid']").val(tid);
				$("#autotopic input[name='tname']").val(tname);
				$("#autotopic input[name='number']").val(number);
				$("#autotopic input[name='pointstart']").val(pointstart);
				$("#autotopic input[name='pointend']").val(pointend);
				$("#autotopic input[name='type']").val(type);
				$("#autotopic input[name='index']").val(index);
				var option = "";
				if('1' == orderby){					
					option = "<option value='2'>时间倒序</option><option selected='selected' value='1'>权重倒序</option>";
				}else{
					option = "<option selected='selected' value='2'>时间倒序</option><option  value='1'>权重倒序</option>";
				}
				$("#autotopic #orderby").html(option);				
			}
			$( "#autotopic" ).dialog( "open" );	
		});
	});
	
	//删除栏目.
	$(".deleteTopic").live("click",function(){
		var id = $(this).attr('id');		
		var _url = "/nc/special/topic/delete/";
		var _data = {};
		_data['id'] = id;
		_data['sid'] = sid;
		$.post(_url,_data,function(data){
			if(data && data['result']==true){
				alert("栏目已删除.");
				preview();
			}else{
				alert("栏目删除失败,请检查后重试!");
			}
		}, "json");	
	});
	
	//上移栏目.
	$(".upTopic").live("click",function(){
		var li = $(this).parents("li");		
		var li_prev = li.prev();
		if(li_prev.length == 0){
			return;
		}
		$(li).fadeOut(300,function(){
			if($(li_prev).before(li))
				$(li).fadeIn(300);
		 });
	});
	
	//下移栏目.
	$(".downTopic").live("click",function(){
		var li = $(this).parents("li");		
		var li_next = li.next();
		if(li_next.length == 0){		 
			return; 
		}
		$(li).fadeOut(300,function(){
			if($(li_next).after(li))
			$(li).fadeIn(300);
		});
	});
	
	
	$("#addWebview").click(function(){
		$( "#webViewTopic #id" ).val( new Date().getTime());
		$( "#webViewTopic #type" ).val("webView");
		$( "#webViewTopic #isedit" ).val("false");			
		$("#webViewTopic" ).dialog( "open" );
	})
	
	$( "#webViewTopic" ).dialog({
		autoOpen: false,
		height: 800,
		width: 600,
		modal: true,
		buttons: {
			"确定": function() {						
				//基本信息
				var _url = "/springgo/spring/nc/special/topic/savawebview.do";
				var _data = {};
				var valid = true;
				$("#webViewTable input").each(function(){
					if($(this).val()==''){
						valid = false;
					}
					if($(this).attr("name")=="webViewPic"||$(this).attr("name")=="webViewUrl"){
						var re=/http.*/;
						if(!re.test($(this).val())){
							alert('图片地址和链接必须以http开头!');	
							return false;
						};
					} 
					if(	typeof(_data[$(this).attr("name")]) == "undefined"){
						_data[$(this).attr("name")] = $(this).val();
					}else{
						_data[$(this).attr("name")] = _data[$(this).attr("name")]+","+$(this).val();
					}
				});
				$("#webViewTable select").each(function(){
					if($(this).val()==''){
						valid = false;
					}
					if(	typeof(_data[$(this).attr("name")]) == "undefined"){
						_data[$(this).attr("name")] = $(this).val();
					}else{
						_data[$(this).attr("name")] = _data[$(this).attr("name")]+","+$(this).val();
					}
				});		
				if(!valid){
					alert('请填写必填字段!');								
					return;
				}
				_data["sid"] = sid;
				$.post(_url,_data,function(data){
					if(data && data['result']==true){
						$( "#webViewTopic" ).dialog( "close" );
						preview();
					}else{
						alert("子模块添加失败，请检查后重试!");	
					}
				});									
			},
			"关闭": function() {
				$( this ).dialog( "close" );
			}
		},
		close: function() {
			
		}
	});	
		
	$("#addImgNewsTopic").click(function(){		
		$( "#autotopic #id" ).val( new Date().getTime());
		$( "#autotopic #type" ).val("imgnews");
		$( "#autotopic #isedit" ).val("false");			
		$( "#autotopic" ).dialog( "open" );
	});
	
	$("#addPhotoTopic").click(function(){		
		$( "#autotopic #id" ).val( new Date().getTime());
		$( "#autotopic #type" ).val("photoset");
		$( "#autotopic #isedit" ).val("false");
		$( "#autotopic" ).dialog( "open" );
	});
	
	$("#addVideoTopic").click(function(){		
		$( "#autotopic #id" ).val( new Date().getTime());
		$( "#autotopic #type" ).val("video");
		$( "#autotopic #isedit" ).val("false");
		$( "#autotopic" ).dialog( "open" );
	});
	
	$("#addNewsTopic").click(function(){		
		$( "#autotopic #id" ).val( new Date().getTime());
		$( "#autotopic #type" ).val("news");
		$( "#autotopic #isedit" ).val("false");
		$( "#autotopic" ).dialog( "open" );
	});
	
	$("#addSpecialTopic").click(function(){		
		$( "#autotopic #id" ).val( new Date().getTime());
		$( "#autotopic #type" ).val("special");
		$( "#autotopic #isedit" ).val("false");
		$( "#autotopic" ).dialog( "open" );
	});	
	
	$( "#autotopic" ).dialog({
		autoOpen: false,
		height: 300,
		width: 600,
		modal: true,
		buttons: {
			"确定": function() {						
				//基本信息
				var _url = "/nc/special/topic/save/";
				var _data = {};
				var valid = true;						
				$("#autotopic input:text").each(function(){
					if($(this).val()==''){
						valid = false;
					}	
					_data[$(this).attr("name")] = $(this).val();
				});							
				$("#autotopic input:hidden").each(function(){								
					_data[$(this).attr("name")] = $(this).val();
				});
				_data['orderby'] = $("select[id='orderby'] option:selected").val();
				if(!valid){
					alert('请填写必填字段!');								
					return;
				}
				_data["sid"] = sid;
				$.post(_url,_data,function(data){
					if(data && data['result']==true){
						$( "#autotopic" ).dialog( "close" );
						preview();
					}else{
						alert("子模块添加失败，请检查后重试!");	
					}
				});									
			},
			"关闭": function() {
				$( this ).dialog( "close" );
			}
		},
		close: function() {
			
		}
	});	
	});
</script>
</body>		
</html>